<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# slomad

```go
import "github.com/ecshreve/slomad/pkg/slomad"
```

## Index

- [Variables](<#variables>)
- [func CreateVolume\(volName string\) error](<#CreateVolume>)
- [func convertJob\(in \*nomadStructs.Job\) \(\*nomadApi.Job, error\)](<#convertJob>)
- [func extractLabels\(ports \[\]\*Port\) \[\]string](<#extractLabels>)
- [func getCSIPluginConfig\(j \*Job\) \*nomadStructs.TaskCSIPluginConfig](<#getCSIPluginConfig>)
- [func getConfig\(name string, jt JobType, args \[\]string, ports \[\]\*Port, vols \[\]Volume\) map\[string\]interface\{\}](<#getConfig>)
- [func getConstraint\(dt DeployTarget\) \*nomadStructs.Constraint](<#getConstraint>)
- [func getDisk\(mb int\) \*nomadStructs.EphemeralDisk](<#getDisk>)
- [func getGroup\(j \*Job\) \*nomadStructs.TaskGroup](<#getGroup>)
- [func getGroupService\(name, portLabel string\) \*nomadStructs.Service](<#getGroupService>)
- [func getGroupServices\(srvcs map\[string\]string\) \[\]\*nomadStructs.Service](<#getGroupServices>)
- [func getMounts\(vols \[\]Volume\) \[\]\*nomadStructs.VolumeMount](<#getMounts>)
- [func getNetworks\(ports \[\]\*Port, priv bool\) \[\]\*nomadStructs.NetworkResource](<#getNetworks>)
- [func getNomadVolumeReq\(vols \[\]Volume\) map\[string\]\*nomadStructs.VolumeRequest](<#getNomadVolumeReq>)
- [func getReschedulePolicy\(jt JobType\) \*nomadStructs.ReschedulePolicy](<#getReschedulePolicy>)
- [func getResource\(tr TaskResource\) \*nomadStructs.Resources](<#getResource>)
- [func getService\(taskName string, portLabel string\) \*nomadStructs.Service](<#getService>)
- [func getServiceWithTags\(taskName, portLabel string, tags \[\]string\) \*nomadStructs.Service](<#getServiceWithTags>)
- [func getServices\(taskName string, portLabels \[\]string\) \[\]\*nomadStructs.Service](<#getServices>)
- [func getTask\(j \*Job\) \*nomadStructs.Task](<#getTask>)
- [func getTemplates\(templates map\[string\]string\) \[\]\*nomadStructs.Template](<#getTemplates>)
- [func getVolumeStrings\(vols \[\]Volume\) \[\]string](<#getVolumeStrings>)
- [func toNomadPort\(p \*Port\) nomadStructs.Port](<#toNomadPort>)
- [func toNomadPortMap\(ports \[\]\*Port\) map\[string\]\[\]nomadStructs.Port](<#toNomadPortMap>)
- [type DeployTarget](<#DeployTarget>)
- [type Job](<#Job>)
  - [func \(j \*Job\) GetNomadApiJob\(force bool\) \(\*nomadApi.Job, error\)](<#Job.GetNomadApiJob>)
- [type JobType](<#JobType>)
  - [func \(jt JobType\) String\(\) string](<#JobType.String>)
- [type Port](<#Port>)
  - [func BasicPortConfig\(val int\) \[\]\*Port](<#BasicPortConfig>)
  - [func basicPort\(val int\) \*Port](<#basicPort>)
- [type ResourceValue](<#ResourceValue>)
- [type TaskResource](<#TaskResource>)
- [type Volume](<#Volume>)


## Variables

<a name="DEFAULT_TASK"></a>

```go
var (
    DEFAULT_TASK = TaskResource{CPU: DEFAULT, MEM: DEFAULT}
    XXTINY_TASK  = TaskResource{CPU: XXTINY, MEM: XXTINY}
    XTINY_TASK   = TaskResource{CPU: XTINY, MEM: XTINY}
    TINY_TASK    = TaskResource{CPU: TINY, MEM: TINY}
    SMALL_TASK   = TaskResource{CPU: SMALL, MEM: SMALL}
    LARGE_TASK   = TaskResource{CPU: LARGE, MEM: LARGE}
    XLARGE_TASK  = TaskResource{CPU: XLARGE, MEM: XLARGE}
    MEM_TASK     = TaskResource{CPU: SMALL, MEM: LARGE}
    COMPUTE_TASK = TaskResource{CPU: LARGE, MEM: SMALL}
    PLEX_TASK    = TaskResource{CPU: XXLARGE, MEM: XXLARGE}
)
```

<a name="DeployTargetRegex"></a>DeployTargetRegex is a map of DeployTarget to a regex string that matches the target's hostname.

```go
var DeployTargetRegex = map[DeployTarget]string{
    ALL:      "^.*$",
    SERVER:   "^server-[0-9]+$",
    WORKER:   "^worker-[0-9]+$",
    CODERBOX: "^coderbox$",
    DEVBOX:   "^devbox$",
    PLEXBOX:  "^plexbox$",
    NODE:     "^node-[0-9]+$",
    NODE0:    "^node-0$",
}
```

<a name="CreateVolume"></a>
## func [CreateVolume](<https://github.com/ecshreve/slomad/blob/main/pkg/slomad/storage.go#L92>)

```go
func CreateVolume(volName string) error
```



<a name="convertJob"></a>
## func [convertJob](<https://github.com/ecshreve/slomad/blob/main/pkg/slomad/job.go#L61>)

```go
func convertJob(in *nomadStructs.Job) (*nomadApi.Job, error)
```

convertJob converts a Nomad Job to a Nomad API Job.

<a name="extractLabels"></a>
## func [extractLabels](<https://github.com/ecshreve/slomad/blob/main/pkg/slomad/port.go#L61>)

```go
func extractLabels(ports []*Port) []string
```

extractLabels returns a list of labels from a list of Ports.

<a name="getCSIPluginConfig"></a>
## func [getCSIPluginConfig](<https://github.com/ecshreve/slomad/blob/main/pkg/slomad/storage.go#L78>)

```go
func getCSIPluginConfig(j *Job) *nomadStructs.TaskCSIPluginConfig
```

getCSIPluginConfig returns a CSIPluginConfig for a given job.

<a name="getConfig"></a>
## func [getConfig](<https://github.com/ecshreve/slomad/blob/main/pkg/slomad/task.go#L64>)

```go
func getConfig(name string, jt JobType, args []string, ports []*Port, vols []Volume) map[string]interface{}
```

getConfig returns a nomad config struct for a given job.

<a name="getConstraint"></a>
## func [getConstraint](<https://github.com/ecshreve/slomad/blob/main/pkg/slomad/job.go#L78>)

```go
func getConstraint(dt DeployTarget) *nomadStructs.Constraint
```

getConstraint returns a nomad constraint for a given deploy target.

<a name="getDisk"></a>
## func [getDisk](<https://github.com/ecshreve/slomad/blob/main/pkg/slomad/group.go#L42>)

```go
func getDisk(mb int) *nomadStructs.EphemeralDisk
```

getDisk returns a nomad disk struct with a default size for a given job.

<a name="getGroup"></a>
## func [getGroup](<https://github.com/ecshreve/slomad/blob/main/pkg/slomad/group.go#L9>)

```go
func getGroup(j *Job) *nomadStructs.TaskGroup
```

getGroup returns a nomad task group struct for a given job.

<a name="getGroupService"></a>
## func [getGroupService](<https://github.com/ecshreve/slomad/blob/main/pkg/slomad/service.go#L66>)

```go
func getGroupService(name, portLabel string) *nomadStructs.Service
```



<a name="getGroupServices"></a>
## func [getGroupServices](<https://github.com/ecshreve/slomad/blob/main/pkg/slomad/service.go#L73>)

```go
func getGroupServices(srvcs map[string]string) []*nomadStructs.Service
```



<a name="getMounts"></a>
## func [getMounts](<https://github.com/ecshreve/slomad/blob/main/pkg/slomad/storage.go#L20>)

```go
func getMounts(vols []Volume) []*nomadStructs.VolumeMount
```

getMounts converts a list of Volumes to a list of Nomad VolumeMounts.

<a name="getNetworks"></a>
## func [getNetworks](<https://github.com/ecshreve/slomad/blob/main/pkg/slomad/port.go#L70>)

```go
func getNetworks(ports []*Port, priv bool) []*nomadStructs.NetworkResource
```

getNetworks converts a list of Ports to a list of Nomad NetworkResources.

<a name="getNomadVolumeReq"></a>
## func [getNomadVolumeReq](<https://github.com/ecshreve/slomad/blob/main/pkg/slomad/storage.go#L55>)

```go
func getNomadVolumeReq(vols []Volume) map[string]*nomadStructs.VolumeRequest
```

getNomadVolumeReq converts a slice of Volumes to map of nomad VolumeRequest.

TODO: validation

<a name="getReschedulePolicy"></a>
## func [getReschedulePolicy](<https://github.com/ecshreve/slomad/blob/main/pkg/slomad/group.go#L29>)

```go
func getReschedulePolicy(jt JobType) *nomadStructs.ReschedulePolicy
```

getReschedulePolicy returns a nomad reschedule policy for a given job.

<a name="getResource"></a>
## func [getResource](<https://github.com/ecshreve/slomad/blob/main/pkg/slomad/task.go#L38>)

```go
func getResource(tr TaskResource) *nomadStructs.Resources
```

getResource is a helper function to convert a TaskResource to a Nomad Resources struct.

<a name="getService"></a>
## func [getService](<https://github.com/ecshreve/slomad/blob/main/pkg/slomad/service.go#L11>)

```go
func getService(taskName string, portLabel string) *nomadStructs.Service
```

getService returns a nomad service struct for a given task.

<a name="getServiceWithTags"></a>
## func [getServiceWithTags](<https://github.com/ecshreve/slomad/blob/main/pkg/slomad/service.go#L59>)

```go
func getServiceWithTags(taskName, portLabel string, tags []string) *nomadStructs.Service
```



<a name="getServices"></a>
## func [getServices](<https://github.com/ecshreve/slomad/blob/main/pkg/slomad/service.go#L47>)

```go
func getServices(taskName string, portLabels []string) []*nomadStructs.Service
```

getServices returns a list of services for a given job.

<a name="getTask"></a>
## func [getTask](<https://github.com/ecshreve/slomad/blob/main/pkg/slomad/task.go#L10>)

```go
func getTask(j *Job) *nomadStructs.Task
```

getTask returns a nomad task struct for a given job.

<a name="getTemplates"></a>
## func [getTemplates](<https://github.com/ecshreve/slomad/blob/main/pkg/slomad/task.go#L45>)

```go
func getTemplates(templates map[string]string) []*nomadStructs.Template
```



<a name="getVolumeStrings"></a>
## func [getVolumeStrings](<https://github.com/ecshreve/slomad/blob/main/pkg/slomad/storage.go#L38>)

```go
func getVolumeStrings(vols []Volume) []string
```

getVolumeString converts a list of Volumes to a list of Volume strings. These are meant to be passed to the docker driver.

<a name="toNomadPort"></a>
## func [toNomadPort](<https://github.com/ecshreve/slomad/blob/main/pkg/slomad/port.go#L15>)

```go
func toNomadPort(p *Port) nomadStructs.Port
```



<a name="toNomadPortMap"></a>
## func [toNomadPortMap](<https://github.com/ecshreve/slomad/blob/main/pkg/slomad/port.go#L39>)

```go
func toNomadPortMap(ports []*Port) map[string][]nomadStructs.Port
```

toNomadPortMap converts a list of Ports to a map of static and dynamic ports.

<a name="DeployTarget"></a>
## type [DeployTarget](<https://github.com/ecshreve/slomad/blob/main/pkg/slomad/types.go#L4>)

DeployTarget is an enum that represents the target of a job.

```go
type DeployTarget int
```

<a name="UNKNOWN_DEPLOY_TARGET"></a>

```go
const (
    UNKNOWN_DEPLOY_TARGET DeployTarget = iota
    ALL
    SERVER
    WORKER
    CODERBOX
    DEVBOX
    PLEXBOX
    NODE
    NODE0
)
```

<a name="Job"></a>
## type [Job](<https://github.com/ecshreve/slomad/blob/main/pkg/slomad/job.go#L14-L28>)

Job is a struct that represents a Nomad Job.

```go
type Job struct {
    Name            string
    Type            JobType
    Shape           TaskResource
    Target          DeployTarget
    Priv            bool
    Ports           []*Port
    Volumes         []Volume
    Args            []string
    Env             map[string]string
    User            string
    Templates       map[string]string
    GroupServices   map[string]string
    TaskServiceTags map[string][]string
}
```

<a name="Job.GetNomadApiJob"></a>
### func \(\*Job\) [GetNomadApiJob](<https://github.com/ecshreve/slomad/blob/main/pkg/slomad/job.go#L31>)

```go
func (j *Job) GetNomadApiJob(force bool) (*nomadApi.Job, error)
```

GetNomadApiJob returns a nomadApi Job for the given slomad.Job.

<a name="JobType"></a>
## type [JobType](<https://github.com/ecshreve/slomad/blob/main/pkg/slomad/types.go#L32>)

JobType is an enum that represents the type of a job.

```go
type JobType int
```

<a name="UNKNOWN_JOB_TYPE"></a>

```go
const (
    UNKNOWN_JOB_TYPE JobType = iota
    SERVICE
    SYSTEM
    BATCH
    STORAGE_CONTROLLER
    STORAGE_NODE
    STORAGE_MONOLITH
)
```

<a name="JobType.String"></a>
### func \(JobType\) [String](<https://github.com/ecshreve/slomad/blob/main/pkg/slomad/types.go#L45>)

```go
func (jt JobType) String() string
```

String implements the Stringer interface for JobType.

<a name="Port"></a>
## type [Port](<https://github.com/ecshreve/slomad/blob/main/pkg/slomad/port.go#L8-L13>)

Port is a struct that represents a network port for a task.

```go
type Port struct {
    Label  string
    To     int
    From   int
    Static bool
}
```

<a name="BasicPortConfig"></a>
### func [BasicPortConfig](<https://github.com/ecshreve/slomad/blob/main/pkg/slomad/port.go#L34>)

```go
func BasicPortConfig(val int) []*Port
```

BasicPortConfig returns a list with a single Port element with a default label.

<a name="basicPort"></a>
### func [basicPort](<https://github.com/ecshreve/slomad/blob/main/pkg/slomad/port.go#L24>)

```go
func basicPort(val int) *Port
```

basicPort returns a basic port struct with a default label.

<a name="ResourceValue"></a>
## type [ResourceValue](<https://github.com/ecshreve/slomad/blob/main/pkg/slomad/types.go#L49>)



```go
type ResourceValue int
```

<a name="XXTINY"></a>

```go
const (
    XXTINY  ResourceValue = 32
    XTINY   ResourceValue = 64
    TINY    ResourceValue = 128
    SMALL   ResourceValue = 256
    DEFAULT ResourceValue = 512
    LARGE   ResourceValue = 1024
    XLARGE  ResourceValue = 2048
    XXLARGE ResourceValue = 4096
)
```

<a name="TaskResource"></a>
## type [TaskResource](<https://github.com/ecshreve/slomad/blob/main/pkg/slomad/types.go#L63-L66>)

TaskResource is a struct that represents the CPU and MEM resources for a task.

```go
type TaskResource struct {
    CPU ResourceValue
    MEM ResourceValue
}
```

<a name="Volume"></a>
## type [Volume](<https://github.com/ecshreve/slomad/blob/main/pkg/slomad/storage.go#L13-L17>)



```go
type Volume struct {
    Src   string
    Dst   string
    Mount bool
}
```

Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)
