<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# slomad

```go
import "github.com/ecshreve/slomad/pkg/slomad"
```

## Index

- [Variables](<#variables>)
- [func ConvertJob(in *nomadStructs.Job) (*nomadApi.Job, error)](<#func-convertjob>)
- [func SubmitApiJob(job *nomadApi.Job) error](<#func-submitapijob>)
- [func extractLabels(ports []*Port) []string](<#func-extractlabels>)
- [func getCSIPluginConfig(j *Job) *nomadStructs.TaskCSIPluginConfig](<#func-getcsipluginconfig>)
- [func getConfig(j *Job) map[string]interface{}](<#func-getconfig>)
- [func getConstraint(j *Job) *nomadStructs.Constraint](<#func-getconstraint>)
- [func getDisk() *nomadStructs.EphemeralDisk](<#func-getdisk>)
- [func getGroup(j *Job) *nomadStructs.TaskGroup](<#func-getgroup>)
- [func getMounts(vols []Volume) []*nomadStructs.VolumeMount](<#func-getmounts>)
- [func getNetworks(ports []*Port) []*nomadStructs.NetworkResource](<#func-getnetworks>)
- [func getNomadVolumes(storage string) map[string]*nomadStructs.VolumeRequest](<#func-getnomadvolumes>)
- [func getReschedulePolicy(j *Job) *nomadStructs.ReschedulePolicy](<#func-getreschedulepolicy>)
- [func getResource(tr TaskResource) *nomadStructs.Resources](<#func-getresource>)
- [func getService(taskName string, portLabel string) *nomadStructs.Service](<#func-getservice>)
- [func getServices(taskName string, portLabels []string) []*nomadStructs.Service](<#func-getservices>)
- [func getTask(j *Job) *nomadStructs.Task](<#func-gettask>)
- [func getTemplates(templates map[string]string) []*nomadStructs.Template](<#func-gettemplates>)
- [func getVolumeStrings(vols []Volume) []string](<#func-getvolumestrings>)
- [func planApiJob(job *nomadApi.Job) error](<#func-planapijob>)
- [func toNomadPort(p *Port) nomadStructs.Port](<#func-tonomadport>)
- [func toNomadPortMap(ports []*Port) map[string][]nomadStructs.Port](<#func-tonomadportmap>)
- [type DeployTarget](<#type-deploytarget>)
- [type Job](<#type-job>)
  - [func NewAppJob(params JobParams) *Job](<#func-newappjob>)
  - [func NewStorageJob(params JobParams) *Job](<#func-newstoragejob>)
  - [func (j *Job) Deploy(force bool) error](<#func-job-deploy>)
  - [func (j *Job) Plan(force bool) error](<#func-job-plan>)
  - [func (j *Job) ToNomadJob(force bool) (*nomadStructs.Job, *nomadApi.Job, error)](<#func-job-tonomadjob>)
- [type JobParams](<#type-jobparams>)
- [type JobType](<#type-jobtype>)
  - [func (jt JobType) String() string](<#func-jobtype-string>)
- [type Port](<#type-port>)
  - [func BasicPortConfig(val int) []*Port](<#func-basicportconfig>)
  - [func basicPort(val int) *Port](<#func-basicport>)
- [type ResourceValue](<#type-resourcevalue>)
- [type StorageParams](<#type-storageparams>)
- [type TaskConfigParams](<#type-taskconfigparams>)
- [type TaskResource](<#type-taskresource>)
- [type Volume](<#type-volume>)


## Variables

```go
var (
    DEFAULT_TASK = TaskResource{CPU: DEFAULT, MEM: DEFAULT}
    TINY_TASK    = TaskResource{CPU: TINY, MEM: TINY}
    SMALL_TASK   = TaskResource{CPU: SMALL, MEM: SMALL}
    LARGE_TASK   = TaskResource{CPU: LARGE, MEM: LARGE}
    XLARGE_TASK  = TaskResource{CPU: XLARGE, MEM: XLARGE}
    MEM_TASK     = TaskResource{CPU: SMALL, MEM: LARGE}
    COMPUTE_TASK = TaskResource{CPU: LARGE, MEM: SMALL}
)
```

DeployTargetRegex is a map of DeployTarget to a regex string that matches the target's hostname.

```go
var DeployTargetRegex = map[DeployTarget]string{
    ALL:      "^.*$",
    SERVER:   "^server-[0-9]+$",
    WORKER:   "^worker-[0-9]+$",
    CODERBOX: "^coderbox$",
    DEVBOX:   "^devbox$",
}
```

## func ConvertJob

```go
func ConvertJob(in *nomadStructs.Job) (*nomadApi.Job, error)
```

convertJob converts a Nomad Job to a Nomad API Job.

## func SubmitApiJob

```go
func SubmitApiJob(job *nomadApi.Job) error
```

submitApiJob creates a nomad api client, and submits the job to nomad.

TODO: move client creation to a helper function

## func extractLabels

```go
func extractLabels(ports []*Port) []string
```

extractLabels returns a list of labels from a list of Ports.

## func getCSIPluginConfig

```go
func getCSIPluginConfig(j *Job) *nomadStructs.TaskCSIPluginConfig
```

getCSIPluginConfig returns a CSIPluginConfig for a given job.

## func getConfig

```go
func getConfig(j *Job) map[string]interface{}
```

getConfig returns a nomad config struct for a given job.

## func getConstraint

```go
func getConstraint(j *Job) *nomadStructs.Constraint
```

getConstraint returns a nomad constraint for a given job.

## func getDisk

```go
func getDisk() *nomadStructs.EphemeralDisk
```

getDisk returns a nomad disk struct with a default size for a given job.

## func getGroup

```go
func getGroup(j *Job) *nomadStructs.TaskGroup
```

getGroup returns a nomad task group struct for a given job.

## func getMounts

```go
func getMounts(vols []Volume) []*nomadStructs.VolumeMount
```

getMounts converts a list of Volumes to a list of Nomad VolumeMounts.

## func getNetworks

```go
func getNetworks(ports []*Port) []*nomadStructs.NetworkResource
```

getNetworks converts a list of Ports to a list of Nomad NetworkResources.

## func getNomadVolumes

```go
func getNomadVolumes(storage string) map[string]*nomadStructs.VolumeRequest
```

getNomadVolumes converts a list of Volumes to a list of Nomad Volumes.

## func getReschedulePolicy

```go
func getReschedulePolicy(j *Job) *nomadStructs.ReschedulePolicy
```

getReschedulePolicy returns a nomad reschedule policy for a given job.

## func getResource

```go
func getResource(tr TaskResource) *nomadStructs.Resources
```

getResource is a helper function to convert a TaskResource to a Nomad Resources struct.

## func getService

```go
func getService(taskName string, portLabel string) *nomadStructs.Service
```

getService returns a nomad service struct for a given task.

## func getServices

```go
func getServices(taskName string, portLabels []string) []*nomadStructs.Service
```

getServices returns a list of services for a given job.

## func getTask

```go
func getTask(j *Job) *nomadStructs.Task
```

getTask returns a nomad task struct for a given job.

## func getTemplates

```go
func getTemplates(templates map[string]string) []*nomadStructs.Template
```

## func getVolumeStrings

```go
func getVolumeStrings(vols []Volume) []string
```

getVolumeString converts a list of Volumes to a list of Volume strings. These are meant to be passed to the docker driver.

## func planApiJob

```go
func planApiJob(job *nomadApi.Job) error
```

planApiJob creates a nomad api client, and runs a plan for the given job, printing the output diff.

## func toNomadPort

```go
func toNomadPort(p *Port) nomadStructs.Port
```

## func toNomadPortMap

```go
func toNomadPortMap(ports []*Port) map[string][]nomadStructs.Port
```

toNomadPortMap converts a list of Ports to a map of static and dynamic ports.

## type DeployTarget

DeployTarget is an enum that represents the target of a job.

```go
type DeployTarget int
```

```go
const (
    UNKNOWN_DEPLOY_TARGET DeployTarget = iota
    ALL
    SERVER
    WORKER
    CODERBOX
    DEVBOX
)
```

## type Job

Job is a struct that represents a Nomad Job.

```go
type Job struct {
    Name       string
    Type       JobType
    Shape      TaskResource
    Constraint string
    Image      string
    Args       []string
    Ports      []*Port
    Env        map[string]string
    User       string
    Storage    string
    Volumes    []Volume
    Templates  map[string]string
}
```

### func NewAppJob

```go
func NewAppJob(params JobParams) *Job
```

NewAppJob creates a new Job for an application.

### func NewStorageJob

```go
func NewStorageJob(params JobParams) *Job
```

NewStorageJob creates a new Job for a storage controller or node.

### func \(\*Job\) Deploy

```go
func (j *Job) Deploy(force bool) error
```

Deploy creates a new API job and submits it to Nomad.

### func \(\*Job\) Plan

```go
func (j *Job) Plan(force bool) error
```

Plan creates a new API job and runs a plan on it.

### func \(\*Job\) ToNomadJob

```go
func (j *Job) ToNomadJob(force bool) (*nomadStructs.Job, *nomadApi.Job, error)
```

ToNomadJob converts a Job to a it's Nomad representations.

## type JobParams

JobParams is a struct that represents the parameters for creating a Job.

```go
type JobParams struct {
    Name   string
    Type   JobType
    Target DeployTarget
    TaskConfigParams
    StorageParams
}
```

## type JobType

JobType is an enum that represents the type of a job.

```go
type JobType int
```

```go
const (
    UNKNOWN_JOB_TYPE JobType = iota
    SERVICE
    SYSTEM
    BATCH
)
```

### func \(JobType\) String

```go
func (jt JobType) String() string
```

String implements the Stringer interface for JobType.

## type Port

Port is a struct that represents a network port for a task.

```go
type Port struct {
    Label  string
    To     int
    From   int
    Static bool
}
```

### func BasicPortConfig

```go
func BasicPortConfig(val int) []*Port
```

BasicPortConfig returns a list with a single Port element with a default label.

### func basicPort

```go
func basicPort(val int) *Port
```

basicPort returns a basic port struct with a default label.

## type ResourceValue

```go
type ResourceValue int
```

```go
const (
    TINY    ResourceValue = 128
    SMALL   ResourceValue = 256
    DEFAULT ResourceValue = 512
    LARGE   ResourceValue = 1024
    XLARGE  ResourceValue = 2048
)
```

## type StorageParams

StorageParams is a struct that represents the parameters for creating a storage associated with a Job.

```go
type StorageParams struct {
    Storage *string
    Volumes []Volume
}
```

## type TaskConfigParams

TaskConfigParams is a struct that represents the parameters for creating a TaskConfig associated with a Job.

```go
type TaskConfigParams struct {
    Args      []string
    Ports     []*Port
    Shape     TaskResource
    Env       map[string]string
    User      string
    Templates map[string]string
}
```

## type TaskResource

TaskResource is a struct that represents the CPU and MEM resources for a task.

```go
type TaskResource struct {
    CPU ResourceValue
    MEM ResourceValue
}
```

## type Volume

```go
type Volume struct {
    Src   string
    Dst   string
    Mount bool
}
```



Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)
