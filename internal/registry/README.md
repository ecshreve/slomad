<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# registry

```go
import "github.com/ecshreve/slomad/internal/registry"
```

## Index

- [Variables](<#variables>)
- [func getStorageArgs\(storage string\) \[\]string](<#getStorageArgs>)
- [func promConfigHelper\(tmpl string\) string](<#promConfigHelper>)


## Variables

<a name="ControllerJob"></a>

```go
var ControllerJob = smd.Job{
    Name:   "storage-controller",
    Type:   smd.STORAGE_CONTROLLER,
    Target: smd.NODE0,
    Ports:  smd.BasicPortConfig(0),
    Shape:  smd.TINY_TASK,
    Args:   getStorageArgs("controller"),
}
```

<a name="GrafanaJob"></a>TODO: mount nomad volume and persist data

```go
var GrafanaJob = smd.Job{
    Name:   "grafana",
    Type:   smd.SERVICE,
    Target: smd.NODE,
    Ports:  smd.BasicPortConfig(3000),
    Shape:  smd.LARGE_TASK,
    User:   "root",
    Env: map[string]string{
        "GF_SERVER_ROOT_URL":            "http://clust.slab.lan:9999/grafana",
        "GF_SERVER_SERVE_FROM_SUB_PATH": "true",
    },
}
```

<a name="LokiJob"></a>

```go
var LokiJob = smd.Job{
    Name:   "loki",
    Type:   smd.SERVICE,
    Target: smd.NODE,
    Ports: []*smd.Port{
        {Label: "http", To: 3100, From: 3100, Static: true},
    },
    Shape: smd.TINY_TASK,
}
```

<a name="NodeExporterJob"></a>

```go
var NodeExporterJob = smd.Job{
    Name:  "node-exporter",
    Type:  smd.SYSTEM,
    Ports: smd.BasicPortConfig(9100),
    Shape: smd.XTINY_TASK,
    Args: []string{
        "--web.listen-address=:${NOMAD_PORT_http}",
        "--path.procfs=/host/proc",
        "--path.sysfs=/host/sys",
        "--collector.filesystem.ignored-mount-points",
        "^/(sys|proc|dev|host|etc|rootfs/var/lib/docker/containers|rootfs/var/lib/docker/overlay2|rootfs/run/docker/netns|rootfs/var/lib/docker/aufs)($$|/)",
    },
    Volumes: []smd.Volume{
        {Src: "/proc", Dst: "/host/proc"},
        {Src: "/sys", Dst: "/host/sys"},
        {Src: "/", Dst: "/rootfs"},
    },
}
```

<a name="NodeJob"></a>

```go
var NodeJob = smd.Job{
    Name:   "storage-node",
    Type:   smd.STORAGE_NODE,
    Target: smd.ALL,
    Ports:  smd.BasicPortConfig(0),
    Shape:  smd.TINY_TASK,
    Args:   getStorageArgs("node"),
}
```

<a name="PlexJob"></a>PlexJob is the job definition for the plex service.

@DEPRECATED: This job is no longer used.

```go
var PlexJob = smd.Job{
    Name:   "plex",
    Type:   smd.SERVICE,
    Target: smd.PLEXBOX,
    Ports:  []*smd.Port{{Label: "http", To: 32400, From: 32400, Static: true}},
    Shape:  smd.PLEX_TASK,
    User:   "root",
    Env: map[string]string{
        "TZ":           "America/Los_Angeles",
        "VERSION":      "docker",
        "ADVERTISE_IP": "http://plex.slab.lan:80",
        "PGID":         "100",
        "PUID":         "1027",
    },
    Volumes: []smd.Volume{
        {Src: "/mnt/nfs/config/plex", Dst: "/config"},
        {Src: "/mnt/nfs/media/music", Dst: "/music"},
        {Src: "/mnt/nfs/media/tv", Dst: "/tv"},
        {Src: "/mnt/nfs/media/movies", Dst: "/movies"},
        {Src: "/dev/shm", Dst: "/transcode"},
    },
}
```

<a name="PrometheusJob"></a>PrometheusJob is a Job for the Prometheus service.

```go
var PrometheusJob = smd.Job{
    Name:      "prometheus",
    Type:      smd.SERVICE,
    Target:    smd.NODE,
    Ports:     smd.BasicPortConfig(9090),
    Shape:     smd.LARGE_TASK,
    Templates: map[string]string{"prometheus.yml": promConfigHelper(prometheusConfig)},
    Volumes:   []smd.Volume{{Src: "local/config", Dst: "/etc/prometheus"}},
    Args: []string{
        "--web.external-url=http://slab.lan/prometheus",
        "--config.file=/etc/prometheus/prometheus.yml",
    },
}
```

<a name="PromtailJob"></a>

```go
var PromtailJob = smd.Job{
    Name:  "promtail",
    Type:  smd.SYSTEM,
    Ports: smd.BasicPortConfig(3200),
    Shape: smd.XTINY_TASK,
    Env:   map[string]string{"HOSTNAME": "${attr.unique.hostname}"},
    Args: []string{
        "-config.file=/local/config/promtail.yml",
        "-server.http-listen-port=${NOMAD_PORT_http}",
    },
    Templates: map[string]string{"promtail.yml": promConfigHelper(promtailConfig)},
    Volumes: []smd.Volume{
        {Src: "/opt/nomad/data/", Dst: "/nomad/"},
        {Src: "/data/promtail", Dst: "/data"},
    },
}
```

<a name="SpeedtestJob"></a>

```go
var SpeedtestJob = smd.Job{
    Name:   "speedtest",
    Type:   smd.SERVICE,
    Target: smd.NODE,
    Ports:  smd.BasicPortConfig(80),
    Shape:  smd.XTINY_TASK,
}
```

<a name="TraefikJob"></a>TraefikJob is the job definition for the traefik service.

@DEPRECATED: This job is no longer used.

```go
var TraefikJob = slomad.Job{
    Name:   "traefik",
    Type:   slomad.SERVICE,
    Target: slomad.ALL,
    Shape:  slomad.DEFAULT_TASK,
    Ports: []*slomad.Port{
        {Label: "web", To: 80, From: 81, Static: true},
        {Label: "admin", To: 8080, From: 8081, Static: true},
    },
    Args: []string{
        "--entryPoints.web.address=:80",
        "--entryPoints.admin.address=:8081",
        "--api=true",
        "--api.dashboard=true",
        "--api.insecure=true",
        "--metrics=true",
        "--metrics.prometheus=true",
        "--metrics.prometheus.addEntryPointsLabels=true",
        "--ping=true",
        "--ping.entryPoint=admin",
        "--providers.consulcatalog=true",
        "--providers.consulcatalog.endpoint.address=127.0.0.1:8500",
        "--providers.consulcatalog.prefix=traefik",
        "--providers.consulcatalog.refreshInterval=30s",
        "--providers.consulcatalog.exposedByDefault=false",
        "--providers.consulcatalog.defaultrule=Host(`{{ .Name }}.slab.lan`)",
        "--providers.consulcatalog.endpoint.tls.insecureskipverify=true",
    },
    GroupServices: map[string]string{"traefik-web": "web"},
    TaskServiceTags: map[string][]string{"traefik": {
        "traefik.enable=true",
        "traefik.http.routers.api.rule=Host(`traefik.slab.lan`)",
        "traefik.http.routers.api.service=api@internal",
    }},
}
```

<a name="UptimeJob"></a>

```go
var UptimeJob = smd.Job{
    Name:   "uptime",
    Type:   smd.SERVICE,
    Target: smd.NODE,
    Ports: []*smd.Port{
        {Label: "http", To: 3001, From: 3001, Static: true},
    },
    Shape: smd.DEFAULT_TASK,
}
```

<a name="WhoamiJob"></a>

```go
var WhoamiJob = smd.Job{
    Name:   "whoami",
    Type:   smd.SERVICE,
    Target: smd.NODE,
    Shape:  smd.XXTINY_TASK,
    Ports:  smd.BasicPortConfig(80),
    TaskServiceTags: map[string][]string{
        "whoami": {
            "urlprefix-/whoami",
        },
    },
}
```

<a name="prometheusConfig"></a>

```go
var prometheusConfig string
```

<a name="promtailConfig"></a>

```go
var promtailConfig string
```

<a name="getStorageArgs"></a>
## func [getStorageArgs](<https://github.com/ecshreve/slomad/blob/main/internal/registry/storage.go#L31>)

```go
func getStorageArgs(storage string) []string
```

getStorageArgs returns the common args for the storage controller and node.

TODO: input validation

<a name="promConfigHelper"></a>
## func [promConfigHelper](<https://github.com/ecshreve/slomad/blob/main/internal/registry/services.go#L11>)

```go
func promConfigHelper(tmpl string) string
```



Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)
